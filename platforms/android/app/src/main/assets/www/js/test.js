var Controller = function () { var e = { self: null, initialize: function () { self = this, console.log("runned controller"), self.bindEvents(), self.renderSearchView(), $(document).ajaxSend(function () { $("#overlay").fadeIn(300) }) }, bindEvents: function () { $(".tab-button").on("click", this.onTabClick) }, onTabClick: function (e) { if (e.preventDefault(), $("#overlay").hide(), !$(this).hasClass("active")) { document.getElementById("explore-tab-button").style.pointerEvents = "none", document.getElementById("build-tab-button").style.pointerEvents = "none", document.getElementById("list-tab-button").style.pointerEvents = "none"; var t = $(this).data("tab"); "#explore-tab" === t ? self.renderSearchView() : "#build-tab" === t ? self.rendeBuildView() : self.renderListView() } }, renderSearchView: function () { $(".tab-button").removeClass("active"), $("#explore-tab-button").addClass("active"), $("#overlay").hide(), $("#tab-content").empty(), $("#tab-content").load("./views/searchcollege.html", function () { document.getElementById("explore-tab-button").style.pointerEvents = "auto", document.getElementById("build-tab-button").style.pointerEvents = "auto", document.getElementById("list-tab-button").style.pointerEvents = "auto", $.mobile.loading().hide(), $(".appname").text("Collegecounsel"), $("#overlay").hide(), $(".filterbutton").on("click", function () { console.log("clicked"); var e = $("#searchform").find(":selected"); console.log(e.val()), self.loadcollegescard(e.val()) }), $("#overlay").hide(), self.loadcollegescard() }) }, loadcollegescard: function (e) { $("#overlay").hide(), $("#searchresultdisplay").empty(); var t = document.getElementById("searchresultdisplay"), a = document.createElement("img"); a.setAttribute("src", "img/notfound.png"), a.setAttribute("alt", "remove"), a.setAttribute("class", "notfound"), a.setAttribute("id", "notfound"), t.appendChild(a); var l = JSON.parse(localStorage.getItem("alldata") || "null"); console.log(e), e ? $.ajax({ url: `https://collegedataserver.herokuapp.com/getData?sort=${e}`, success: function (e) { self.subLoadCard(e), self.LoadStatsModal(".collegename") }, error: function (e, t, a) { var l = e.status + ": " + e.statusText; alert("Error - " + l) } }).done(function () { setTimeout(function () { $("#overlay").fadeOut(300) }, 500) }) : l ? (console.log("load from local"), self.subLoadCard(l), self.LoadStatsModal(".collegename")) : $.ajax({ url: "https://collegedataserver.herokuapp.com/getData", success: function (e) { localStorage.setItem("alldata", JSON.stringify(e)), self.subLoadCard(e), self.LoadStatsModal(".collegename") }, error: function (e, t, a) { var l = e.status + ": " + e.statusText; alert("Error - " + l) } }).done(function () { setTimeout(function () { $("#overlay").fadeOut(300) }, 500) }) }, subLoadCard: function (e) { console.log(e); for (schoolname in e) { 0; var t = document.getElementById("searchresultdisplay"), a = document.createElement("div"), l = document.createElement("h4"), o = document.createElement("h6"), n = document.createElement("h6"); l.innerHTML = schoolname, o.innerHTML = e[schoolname].location, n.innerHTML = `Acceptance Rate: ${e[schoolname]["acceptance rate"]}%`, l.setAttribute("class", "collegename"), l.setAttribute("id", schoolname), o.setAttribute("class", "location"), n.setAttribute("class", "acceptancerate"), a.setAttribute("id", schoolname), a.appendChild(l), a.appendChild(n), a.appendChild(o), a.setAttribute("class", "collegecard"), t.appendChild(a) } }, LoadStatsModal: function (e) { $(e).on("click", function () { $(this).addClass("underline"); var t = JSON.parse(localStorage.getItem("alldata") || "null"); console.log(e); var a = $(this).parent().attr("id"); console.log(a), t ? (console.log("load from local"), self.subLoadModal(t, a, `[id='${a}']`)) : $.ajax({ url: "https://collegedataserver.herokuapp.com/getData", success: function (e) { self.subLoadModal(e, a) } }).done(function () { setTimeout(function () { $("#overlay").fadeOut(300) }, 500) }) }) }, subLoadModal: function (e, t, a) { data = e[t], console.log(e), console.log(a); var l = document.getElementById("myModal"), o = document.getElementsByClassName("close")[0]; if ($("#modalschoolname").text(data.name), $(".mdacceptancerate").text(`Acceptance Rate: ${data["acceptance rate"]}%`), $(".GPA").text(`Middle 50% Admitted GPA(UW): ${data["gpa(uw) 75th percentile"]}-${data["gpa(uw) 25th percentile"]}`), $(".SAT").text(`Middle 50% Admitted SAT: ${data["SAT 75th percentile"]}-${data["SAT 25th percenile"]}`), $(".ACT").text(`Middle 50% Admitted ACT: ${data["ACT 75th percentile"]}-${data["ACT 25th percentile"]}`), 0 == data.Interview) var n = "No Interview"; else n = "Interview Required"; $(".interview").text(n), $(".admitted").text(`Total Admitted: ${data["total admitted"]}`), $(".graduationrate").text(`Graduation Rate: ${data["graduation rate"]}`), $(".Yield").text(`Yield Rate: ${data["admission yield"]}`), $(".avgcost").text(`Average Annual Cost: $${data["average cost of attendance per year"]}`), $(".totalundergrad").text(`Total Undergrad Enrollment: ${data["estimated total undergrad enrollment"]}`), $(".totalenroll").text(`Total Student Enrollment: ${data["estimated total enrollment"]}`), l.style.display = "block", o.onclick = function () { l.style.display = "none", console.log($(a).text()), $(a).removeClass("underline") }, window.onclick = function (e) { e.target == l && (l.style.display = "none", $(a).removeClass("underline")) } }, rendeBuildView: function () { $(".tab-button").removeClass("active"), $("#build-tab-button").addClass("active"); var e = $("#tab-content"); $("#overlay").hide(), e.empty(), $("#tab-content").load("./views/build.html", function () { $.mobile.loading().hide(), document.getElementById("explore-tab-button").style.pointerEvents = "auto", document.getElementById("build-tab-button").style.pointerEvents = "auto", document.getElementById("list-tab-button").style.pointerEvents = "auto", $("#overlay").hide(), $(".appname").text("Build My List"), $(".majorinput").prop("disabled", !0), $(".maxcost").prop("disabled", !0), $(".georest").prop("disabled", !0), $(".ifcost").change(function () { this.checked ? $(".maxcost").prop("disabled", !1) : $(".maxcost").prop("disabled", !0) }), $(".ifgeo").change(function () { this.checked ? $(".georest").prop("disabled", !1) : $(".georest").prop("disabled", !0) }), $(".ifmajor").change(function () { this.checked ? $(".majorinput").prop("disabled", !1) : $(".majorinput").prop("disabled", !0) }), $(".buildbutton").on("click", function () { self.buildcollegelist() }), $("#overlay").hide(); var e = JSON.parse(localStorage.getItem("builtlist") || "null"), t = JSON.parse(localStorage.getItem("alldata") || "null"); t && e && ($("#overlay").hide(), console.log(t), console.log(e), self.loadBuiltList(e, t)) }) }, loadBuiltList: function (e, t) { for (type in $(".builtlist").empty(), $("#overlay").hide(), e) { if (console.log(type), "Reach" == type) var a = "Reach", l = "reachcard"; else if ("Match" == type) a = "Match", l = "matchcard"; else a = "Safety", l = "safetycard"; for (i in console.log(e), e[type]) { school = e[type][i], console.log(e[school]), console.log(t[school]["acceptance rate"]); var o = document.getElementById("builtlist"), n = document.createElement("div"), s = document.createElement("table"), c = document.createElement("th"), r = document.createElement("tr"), d = document.createElement("th"), u = document.createElement("tr"), m = document.createElement("th"), p = document.createElement("button"), h = document.createElement("th"), g = document.createElement("th"), b = document.createElement("tr"), f = document.createElement("h4"), y = document.createElement("h6"), v = document.createElement("h6"), A = document.createElement("h6"), E = document.createElement("h6"); document.createElement("h3").innerHTML = a, p.innerHTML = "Add to college list", f.innerHTML = `${school} (${a})`, E.innerHTML = `Acceptance Rate: ${t[school]["acceptance rate"]}%`, y.innerHTML = `Middle 50% Admitted GPA(UW): ${t[school]["gpa(uw) 75th percentile"]}-${t[school]["gpa(uw) 25th percentile"]}`, v.innerHTML = `Middle 50% Admitted SAT: ${t[school]["SAT 75th percentile"]}-${t[school]["SAT 25th percenile"]}`, A.innerHTML = `Middle 50% Admitted ACT: ${t[school]["ACT 75th percentile"]}-${t[school]["ACT 25th percentile"]}`, f.setAttribute("class", "buildSchoolName"), f.setAttribute("id", school), E.setAttribute("class", "buildAcc"), y.setAttribute("class", "buildgpa"), v.setAttribute("class", "buildSAT"), A.setAttribute("class", "buildACT"), s.setAttribute("class", "buildtable"), c.setAttribute("class", "buildth"), r.setAttribute("class", "buildtr"), d.setAttribute("class", "buildth"), m.setAttribute("class", "buildaddbuttonth"), p.setAttribute("class", "addbutton"), u.setAttribute("class", "buildtr"), b.setAttribute("class", "buildtr"), h.setAttribute("class", "buildth"), g.setAttribute("class", "buildth"), n.setAttribute("class", l), n.setAttribute("id", school), m.appendChild(p), c.appendChild(E), r.appendChild(c), d.appendChild(y), u.appendChild(d), r.appendChild(m), h.appendChild(v), g.appendChild(A), b.appendChild(h), b.appendChild(g), s.appendChild(r), s.appendChild(u), s.appendChild(b), n.appendChild(f), n.appendChild(E), n.appendChild(s), o.appendChild(n) } } self.LoadStatsModal(".buildSchoolName"), $(".addbutton").click(function () { if (!(e = JSON.parse(localStorage.getItem("mylist") || "null"))) { var e = {}; localStorage.setItem("mylist", JSON.stringify(e)), console.log("created new ") } e = JSON.parse(localStorage.getItem("mylist")); type = $(this).parent().parent().parent().parent().attr("class").split("card")[0], school = $(this).parent().parent().parent().parent().attr("id"), school in e ? alert(`${school} already in college list!`) : (e[school] = type, console.log("added"), window.plugins.toast.showLongBottom(`${school} added to college list`)), localStorage.setItem("mylist", JSON.stringify(e)), console.log(JSON.parse(localStorage.getItem("mylist"))) }) }, buildcollegelist: function () { console.log("build"); var e = [".mygpa", ".mytestscore", ".numberofschool"], t = "?", a = $(".mygpa").val(); console.log(a), t += `gpa=${a}`; var l = $(".mytestscore").val(); if (2 == l.length) var o = "act"; else o = "sat"; t += `&${o}=${l}`, t += `&number=${$(".numberofschool").val()}`, $(".ifcost").is(":checked") && (e.push(".maxcost"), t += `&maxcost=${$(".maxcost").val()}`), $(".ifgeo").is(":checked") && (e.push(".georest"), t += `&state=${$(".georest").find(":selected").val()}`), $(".ifmajor").is(":checked") && (e.push(".majorinput"), t += `&major=${$(".majorinput").val()}`); for (var n = 0; n < e.length; n++) { var s = $(e[n]).val(); if (".majorinput" != e[n] && ".georest" != e[n]) { if (isNaN(parseFloat(s))) return void alert("Invalid Input") } else if ("" == s || null == s) return void alert("Invalid Input") } $.ajax({ url: `https://collegedataserver.herokuapp.com/build${t}`, success: function (e) { $.ajax({ url: "https://collegedataserver.herokuapp.com/getData", success: function (t) { localStorage.setItem("builtlist", JSON.stringify(e)), self.loadBuiltList(e, t) } }).done(function () { setTimeout(function () { $("#overlay").fadeOut(300) }, 500) }) }, error: function (e, t, a) { e.status, e.statusText; $("#overlay").hide(), alert("Invalid Input") } }) }, renderListView: function () { $(".tab-button").removeClass("active"), $("#list-tab-button").addClass("active"); var e = $("#tab-content"); $("#overlay").hide(), e.empty(), $("#tab-content").load("./views/list.html", function () { $.mobile.loading().hide(), document.getElementById("explore-tab-button").style.pointerEvents = "auto", document.getElementById("build-tab-button").style.pointerEvents = "auto", document.getElementById("list-tab-button").style.pointerEvents = "auto", $("#overlay").hide(), $(".appname").text("My College List"), self.loadUserCollegeList(), $(".removebutton").on("click", function () { if ($(this).attr("src", "img/logo.png"), schoolname = $(this).parent().attr("id"), console.log(schoolname), confirm(`Delete ${schoolname} from college list?`)) { $(this).attr("src", "img/btn.png"); var e = JSON.parse(localStorage.getItem("mylist") || "null"); if (e) { $(this).parent().remove(), delete e[schoolname], localStorage.setItem("mylist", JSON.stringify(e)), console.log(localStorage.getItem("mylist")); var t = document.getElementById("usercollegelist"), a = document.createElement("h3"); if (a.innerHTML = "You have no colleges under you list. Go to 'Build my List' to add colleges.", !e || 0 == Object.keys(e).length) return void t.appendChild(a) } else alert("Error occured") } else $(this).attr("src", "img/btn.png") }), $("#overlay").hide(), self.LoadStatsModal(".schoolname") }) }, loadUserCollegeList: function () { var e = JSON.parse(localStorage.getItem("mylist") || "null"), t = document.getElementById("usercollegelist"), a = document.createElement("h3"); if (a.innerHTML = "You have no colleges under you list. Go to 'Build my List' to add colleges.", e && 0 != Object.keys(e).length) { for (schoolname in e) type = e[schoolname], "reach" == type && self.constructEach(schoolname, type); for (schoolname in e) type = e[schoolname], "match" == type && self.constructEach(schoolname, type); for (schoolname in e) type = e[schoolname], "safety" == type && self.constructEach(schoolname, type) } else t.appendChild(a) }, getData: function () { var e = JSON.parse(localStorage.getItem("alldata") || "null"); if (e) return console.log("load from local"), e; $.ajax({ url: "https://collegedataserver.herokuapp.com/getData", success: function (e) { return localStorage.setItem("alldata", JSON.stringify(e)), JSON.parse(localStorage.getItem("alldata")) }, error: function (e, t, a) { var l = e.status + ": " + e.statusText; return alert("Error - " + l), {} } }).done(function () { setTimeout(function () { $("#overlay").fadeOut(300) }, 500) }) }, constructEach: function (e, t) { var a = this.getData(), l = document.getElementById("usercollegelist"); console.log(l); var o = document.createElement("div"), n = document.createElement("h4"), s = document.createElement("p"), c = document.createElement("h6"), i = document.createElement("IMG"); if (i.setAttribute("src", "img/btn.png"), i.setAttribute("width", "30"), i.setAttribute("height", "30"), i.setAttribute("alt", "remove"), i.setAttribute("class", "removebutton"), n.innerHTML = `${e} (${t})`, s.innerHTML = a[e].location, c.innerHTML = `Acceptance Rate: ${a[e]["acceptance rate"]}%`, n.setAttribute("class", "schoolname"), n.setAttribute("id", e), c.setAttribute("class", "accrate"), s.setAttribute("class", "location"), o.appendChild(n), o.appendChild(i), o.appendChild(c), o.appendChild(s), o.setAttribute("id", e), "reach" == type) var r = "reachcard"; else if ("match" == type) r = "matchcard"; else r = "safetycard"; o.setAttribute("class", r), l.appendChild(o) } }; return e.initialize(), e };